name: Workato CI/CD

on:
  push:
    branches: [ main ]

jobs:
  workato-download:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Docker
        uses: docker/setup-buildx-action@v3

      - name: Check if Workato image is already downloaded
        id: check_image
        run: |
         if ! docker image inspect alpine > /dev/null 2>&1; then
            echo "Downloading Alpine..."
            docker pull alpine
            else
            echo "Alpine already downloaded â€” skipping."
            fi

      - name: Download container
        if: env.exists == 'false'
        run: |
          echo "Downloading Alpine container..."
          docker pull alpine
          echo "Workato image downloaded successfully."

      - name: Create flag file
        if: env.exists == 'false'
        run: |
          echo "true" > .workato_downloaded
          echo "Flag created to indicate image has been downloaded."
          
      - name: Verify Alpine container
        run: |
          docker images | grep workato || echo "Workato image not found!"
