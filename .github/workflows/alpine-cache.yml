name: Workato Container with Flag Check

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  workato-container:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Check or create flag
        id: check-flag
        run: |
          FLAG_FILE="alpine_downloaded.flag"
          if [ -f "$FLAG_FILE" ]; then
            echo "Alpine image already downloaded. Skipping download."
            echo "skip_download=true" >> $GITHUB_ENV
          else
            echo "Alpine not found, will download now."
            echo "skip_download=false" >> $GITHUB_ENV
          fi

      - name: Download Alpine container (if needed)
        if: env.skip_download == 'false'
        run: |
          echo "Downloading Alpine container..."
          docker pull alpine:latest
          echo "Alpine downloaded."
          touch alpine_downloaded.flag

      - name: Run Alpine container
        run: |
          docker run alpine echo "Hello from Alpine container!"
